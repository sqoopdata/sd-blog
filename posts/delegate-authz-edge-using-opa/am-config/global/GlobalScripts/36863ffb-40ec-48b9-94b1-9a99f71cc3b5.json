{
  "metadata" : {
    "realm" : null,
    "amsterVersion" : "7.1.0",
    "entityType" : "GlobalScripts",
    "entityId" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTQtMjAyMCBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuZXhjZXB0aW9ucy5JbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbgppbXBvcnQgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5Vc2VySW5mb0NsYWltcwppbXBvcnQgb3JnLmZvcmdlcm9jay5vcGVuaWRjb25uZWN0LkNsYWltCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFR5cGUKCi8qCiogRGVmaW5lZCB2YXJpYWJsZXM6CiogbG9nZ2VyIC0gYWx3YXlzIHByZXNlbnRzLCB0aGUgIk9BdXRoMlByb3ZpZGVyIiBkZWJ1ZyBsb2dnZXIgaW5zdGFuY2UKKiBjbGFpbXMgLSBhbHdheXMgcHJlc2VudCwgZGVmYXVsdCBzZXJ2ZXIgcHJvdmlkZWQgY2xhaW1zIC0gTWFwPFN0cmluZywgT2JqZWN0PgoqIGNsYWltT2JqZWN0cyAtIGFsd2F5cyBwcmVzZW50LCBkZWZhdWx0IHNlcnZlciBwcm92aWRlZCBjbGFpbXMgLSBMaXN0PENsYWltPgoqIHNlc3Npb24gLSBwcmVzZW50IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIHRoZSBzZXNzaW9uIGNvb2tpZSwgdGhlIHVzZXIncyBzZXNzaW9uIG9iamVjdAoqIGlkZW50aXR5IC0gYWx3YXlzIHByZXNlbnQsIHRoZSBpZGVudGl0eSBvZiB0aGUgcmVzb3VyY2Ugb3duZXIKKiBzY29wZXMgLSBhbHdheXMgcHJlc2VudCwgdGhlIHJlcXVlc3RlZCBzY29wZXMKKiBzY3JpcHROYW1lIC0gYWx3YXlzIHByZXNlbnQsIHRoZSBkaXNwbGF5IG5hbWUgb2YgdGhlIHNjcmlwdAoqIHJlcXVlc3RQcm9wZXJ0aWVzIC0gYWx3YXlzIHByZXNlbnQsIGNvbnRhaW5zIGEgbWFwIG9mIHJlcXVlc3QgcHJvcGVydGllczoKKiAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RVcmkgLSB0aGUgcmVxdWVzdCBVUkkKKiAgICAgICAgICAgICAgICAgICAgIHJlYWxtIC0gdGhlIHJlYWxtIHRoYXQgdGhlIHJlcXVlc3QgcmVsYXRlcyB0bwoqICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBhcmFtcyAtIGEgbWFwIG9mIHRoZSByZXF1ZXN0IHBhcmFtcyBhbmQvb3IgcG9zdGVkIGRhdGEuIEVhY2ggdmFsdWUgaXMgYSBsaXN0IG9mIG9uZSBvcgoqICAgICAgICAgICAgICAgICAgICAgbW9yZSBwcm9wZXJ0aWVzLiBQbGVhc2Ugbm90ZSB0aGF0IHRoZXNlIHNob3VsZCBiZSBoYW5kbGVkIGluIGFjY29yZGFuY2Ugd2l0aCBPV0FTUCBiZXN0IHByYWN0aWNlcy4KKiBjbGllbnRQcm9wZXJ0aWVzIC0gcHJlc2VudCBpZiB0aGUgY2xpZW50IHNwZWNpZmllZCBpbiB0aGUgcmVxdWVzdCB3YXMgaWRlbnRpZmllZCwgY29udGFpbnMgYSBtYXAgb2YgY2xpZW50CiogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6CiogICAgICAgICAgICAgICAgICAgIGNsaWVudElkIC0gdGhlIGNsaWVudCdzIFVyaSBmb3IgdGhlIHJlcXVlc3QgbG9jYWxlCiogICAgICAgICAgICAgICAgICAgIGFsbG93ZWRHcmFudFR5cGVzIC0gbGlzdCBvZiB0aGUgYWxsb3dlZCBncmFudCB0eXBlcyAob3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5HcmFudFR5cGUpCiogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRoZSBjbGllbnQKKiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFJlc3BvbnNlVHlwZXMgLSBsaXN0IG9mIHRoZSBhbGxvd2VkIHJlc3BvbnNlIHR5cGVzIGZvciB0aGUgY2xpZW50CiogICAgICAgICAgICAgICAgICAgIGFsbG93ZWRTY29wZXMgLSBsaXN0IG9mIHRoZSBhbGxvd2VkIHNjb3BlcyBmb3IgdGhlIGNsaWVudAoqICAgICAgICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzIC0gQSBtYXAgb2YgdGhlIGN1c3RvbSBwcm9wZXJ0aWVzIG9mIHRoZSBjbGllbnQuCiogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0cyBvciBtYXBzIHdpbGwgYmUgaW5jbHVkZWQgYXMgc3ViLW1hcHMsIGUuZzoKKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RNYXBbS2V5MV09VmFsdWUxIHdpbGwgYmUgcmV0dXJuZWQgYXMgdGVzdG1hcCAtPiBLZXkxIC0+IFZhbHVlMQoqIHJlcXVlc3RlZENsYWltcyAtIE1hcDxTdHJpbmcsIFNldDxTdHJpbmc+PgoqICAgICAgICAgICAgICAgICAgYWx3YXlzIHByZXNlbnQsIG5vdCBlbXB0eSBpZiB0aGUgcmVxdWVzdCBjb250YWlucyBhIGNsYWltcyBwYXJhbWV0ZXIgYW5kIHNlcnZlciBoYXMgZW5hYmxlZAoqICAgICAgICAgICAgICAgICAgY2xhaW1zX3BhcmFtZXRlcl9zdXBwb3J0ZWQsIG1hcCBvZiByZXF1ZXN0ZWQgY2xhaW1zIHRvIHBvc3NpYmxlIHZhbHVlcywgb3RoZXJ3aXNlIGVtcHR5LAoqICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkIGNsYWltcyB3aXRoIG5vIHJlcXVlc3RlZCB2YWx1ZXMgd2lsbCBoYXZlIGEga2V5IGJ1dCBubyB2YWx1ZSBpbiB0aGUgbWFwLiBBIGtleSB3aXRoCiogICAgICAgICAgICAgICAgICBhIHNpbmdsZSB2YWx1ZSBpbiBpdHMgU2V0IGluZGljYXRlcyB0aGlzIGlzIHRoZSBvbmx5IHZhbHVlIHRoYXQgc2hvdWxkIGJlIHJldHVybmVkLgoqIHJlcXVlc3RlZFR5cGVkQ2xhaW1zIC0gTGlzdDxDbGFpbT4KKiAgICAgICAgICAgICAgICAgICAgICAgYWx3YXlzIHByZXNlbnQsIG5vdCBlbXB0eSBpZiB0aGUgcmVxdWVzdCBjb250YWlucyBhIGNsYWltcyBwYXJhbWV0ZXIgYW5kIHNlcnZlciBoYXMgZW5hYmxlZAoqICAgICAgICAgICAgICAgICAgICAgICBjbGFpbXNfcGFyYW1ldGVyX3N1cHBvcnRlZCwgbGlzdCBvZiByZXF1ZXN0ZWQgY2xhaW1zIHdpdGggY2xhaW0gbmFtZSwgcmVxdWVzdGVkIHBvc3NpYmxlIHZhbHVlcwoqICAgICAgICAgICAgICAgICAgICAgICBhbmQgaWYgY2xhaW0gaXMgZXNzZW50aWFsLCBvdGhlcndpc2UgZW1wdHksCiogICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RlZCBjbGFpbXMgd2l0aCBubyByZXF1ZXN0ZWQgdmFsdWVzIHdpbGwgaGF2ZSBhIGNsYWltIHdpdGggbm8gdmFsdWVzLiBBIGNsYWltcyB3aXRoCiogICAgICAgICAgICAgICAgICAgICAgIGEgc2luZ2xlIHZhbHVlIGluZGljYXRlcyB0aGlzIGlzIHRoZSBvbmx5IHZhbHVlIHRoYXQgc2hvdWxkIGJlIHJldHVybmVkLgoqIGNsYWltc0xvY2FsZXMgLSB0aGUgdmFsdWVzIGZyb20gdGhlICdjbGFpbXNfbG9jYWxlcycgcGFyYW1ldGVyIC0gTGlzdDxTdHJpbmc+CiogUmVxdWlyZWQgdG8gcmV0dXJuIGEgTWFwIG9mIGNsYWltcyB0byBiZSBhZGRlZCB0byB0aGUgaWRfdG9rZW4gY2xhaW1zCioKKiBFeHBlY3RlZCByZXR1cm4gdmFsdWUgc3RydWN0dXJlOgoqIFVzZXJJbmZvQ2xhaW1zIHsKKiAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IHZhbHVlczsgLy8gVGhlIHZhbHVlcyBvZiB0aGUgY2xhaW1zIGZvciB0aGUgdXNlciBpbmZvcm1hdGlvbgoqICAgIE1hcDxTdHJpbmcsIExpc3Q8U3RyaW5nPj4gY29tcG9zaXRlU2NvcGVzOyAvLyBNYXBwaW5nIG9mIHNjb3BlIG5hbWUgdG8gYSBsaXN0IG9mIGNsYWltIG5hbWVzLgoqIH0KKi8KCi8vIHVzZXIgc2Vzc2lvbiBub3QgZ3VhcmFudGVlZCB0byBiZSBwcmVzZW50CmJvb2xlYW4gc2Vzc2lvblByZXNlbnQgPSBzZXNzaW9uICE9IG51bGwKCi8qCiAqIFB1bGxzIGZpcnN0IHZhbHVlIGZyb20gdXNlcnMgcHJvZmlsZSBhdHRyaWJ1dGUKICoKICogQHBhcmFtIGNsYWltIFRoZSBjbGFpbSBvYmplY3QuCiAqIEBwYXJhbSBhdHRyIFRoZSBwcm9maWxlIGF0dHJpYnV0ZSBuYW1lLgogKi8KZGVmIGZyb21TZXQgPSB7IGNsYWltLCBhdHRyIC0+CiAgICBpZiAoYXR0ciAhPSBudWxsICYmIGF0dHIuc2l6ZSgpID09IDEpewogICAgICAgIGF0dHIuaXRlcmF0b3IoKS5uZXh0KCkKICAgIH0gZWxzZSBpZiAoYXR0ciAhPSBudWxsICYmIGF0dHIuc2l6ZSgpID4gMSl7CiAgICAgICAgYXR0cgogICAgfSBlbHNlIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBHb3QgYW4gZW1wdHkgcmVzdWx0IGZvciBjbGFpbT0kY2xhaW0iKTsKICAgIH0KfQoKLy8gLS0tdnZ2dnZ2dnZ2di0tLSBFWEFNUExFIENMQUlNIEFUVFJJQlVURSBSRVNPTFZFUiBGVU5DVElPTlMgLS0tdnZ2dnZ2dnZ2di0tLQovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCByZXNvbHZlcyB0aGUgdmFsdWUgb2YgdGhlIGNsYWltIGZyb20gaXRzIHJlcXVlc3RlZCB2YWx1ZXMuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCByZXR1cm4gYSB2YWx1ZSBpZiB0aGUgY2xhaW0gaGFzIG9uZSByZXF1ZXN0ZWQgdmFsdWVzLCBvdGhlcndpc2UgYW4gZXhjZXB0aW9uIGlzIHRocm93bi4KICovCmRlZmF1bHRDbGFpbVJlc29sdmVyID0geyBjbGFpbSAtPgogICAgaWYgKGNsYWltLmdldFZhbHVlcygpLnNpemUoKSA9PSAxKSB7CiAgICAgICAgWyhjbGFpbS5nZXROYW1lKCkpOiBjbGFpbS5nZXRWYWx1ZXMoKS5pdGVyYXRvcigpLm5leHQoKV0KICAgIH0gZWxzZSB7CiAgICAgICAgWzpdCiAgICB9Cn0KCi8qCiAqIENsYWltIHJlc29sdmVyIHdoaWNoIHJlc29sdmVzIHRoZSB2YWx1ZSBvZiB0aGUgY2xhaW0gYnkgbG9va2luZyB1cCB0aGUgdXNlcidzIHByb2ZpbGUuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCByZXR1cm4gYSB2YWx1ZSBmb3IgdGhlIGNsYWltIGlmOgogKiAjIHRoZSB1c2VyJ3MgcHJvZmlsZSBhdHRyaWJ1dGUgaXMgbm90IG51bGwKICogIyBBTkQgdGhlIGNsYWltIGNvbnRhaW5zIG5vIHJlcXVlc3RlZCB2YWx1ZXMKICogIyBPUiB0aGUgY2xhaW0gY29udGFpbnMgcmVxdWVzdGVkIHZhbHVlcyBhbmQgdGhlIHZhbHVlIGZyb20gdGhlIHVzZXIncyBwcm9maWxlIGlzIGluIHRoZSBsaXN0IG9mIHZhbHVlcwogKgogKiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgaWYgKGlkZW50aXR5ICE9IG51bGwpIHsKICAgICAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwgJiYgKGNsYWltLmdldFZhbHVlcygpID09IG51bGwgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuaXNFbXB0eSgpIHx8IGNsYWltLmdldFZhbHVlcygpLmNvbnRhaW5zKHVzZXJQcm9maWxlVmFsdWUpKSkgewogICAgICAgICAgICByZXR1cm4gWyhjbGFpbS5nZXROYW1lKCkpOiB1c2VyUHJvZmlsZVZhbHVlXQogICAgICAgIH0KICAgIH0KICAgIFs6XQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCByZXNvbHZlcyB0aGUgdmFsdWUgb2YgdGhlIGNsYWltIG9mIHRoZSB1c2VyJ3MgYWRkcmVzcy4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGZvciB0aGUgY2xhaW0gaWY6CiAqICMgdGhlIHZhbHVlIG9mIHRoZSBhZGRyZXNzIGlzIG5vdCBudWxsCiAqCiAqLwp1c2VyQWRkcmVzc0NsYWltUmVzb2x2ZXIgPSB7IGNsYWltLCBpZGVudGl0eSAtPgogICAgaWYgKGlkZW50aXR5ICE9IG51bGwpIHsKICAgICAgICBhZGRyZXNzRm9ybWF0dGVkVmFsdWUgPSBmcm9tU2V0KGNsYWltLmdldE5hbWUoKSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKCJwb3N0YWxhZGRyZXNzIikpCiAgICAgICAgaWYgKGFkZHJlc3NGb3JtYXR0ZWRWYWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgImZvcm1hdHRlZCIgOiBhZGRyZXNzRm9ybWF0dGVkVmFsdWUKICAgICAgICAgICAgXQogICAgICAgIH0KICAgIH0KICAgIFs6XQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCByZXNvbHZlcyB0aGUgdmFsdWUgb2YgdGhlIGNsYWltIGJ5IGxvb2tpbmcgdXAgdGhlIHVzZXIncyBwcm9maWxlLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgcmV0dXJuIGEgdmFsdWUgZm9yIHRoZSBjbGFpbSBpZjoKICogIyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIGlzIG5vdCBudWxsCiAqICMgQU5EIHRoZSBjbGFpbSBjb250YWlucyBubyByZXF1ZXN0ZWQgdmFsdWVzCiAqICMgT1IgdGhlIGNsYWltIGNvbnRhaW5zIHJlcXVlc3RlZCB2YWx1ZXMgYW5kIHRoZSB2YWx1ZSBmcm9tIHRoZSB1c2VyJ3MgcHJvZmlsZSBpcyBpbiB0aGUgbGlzdCBvZiB2YWx1ZXMKICoKICogSWYgdGhlIGNsYWltIGlzIGVzc2VudGlhbCBhbmQgbm8gdmFsdWUgaXMgZm91bmQgYW4gSW52YWxpZFJlcXVlc3RFeGNlcHRpb24gd2lsbCBiZSB0aHJvd24gYW5kIHJldHVybmVkIHRvIHRoZSB1c2VyLgogKiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KZXNzZW50aWFsQ2xhaW1SZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAgIGlmIChpZGVudGl0eSAhPSBudWxsKSB7CiAgICAgICAgdXNlclByb2ZpbGVWYWx1ZSA9IGZyb21TZXQoY2xhaW0uZ2V0TmFtZSgpLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgICAgICBpZiAoY2xhaW0uaXNFc3NlbnRpYWwoKSAmJiAodXNlclByb2ZpbGVWYWx1ZSA9PSBudWxsIHx8IHVzZXJQcm9maWxlVmFsdWUuaXNFbXB0eSgpKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFJlcXVlc3RFeGNlcHRpb24oIkNvdWxkIG5vdCBwcm92aWRlIHZhbHVlIGZvciBlc3NlbnRpYWwgY2xhaW0gJGNsYWltIikKICAgICAgICB9CiAgICAgICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IHVzZXJQcm9maWxlVmFsdWVdCiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIFs6XQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCBleHBlY3RzIHRoZSB1c2VyJ3MgcHJvZmlsZSBhdHRyaWJ1dGUgdmFsdWUgdG8gYmUgaW4gdGhlIGZvbGxvd2luZyBmb3JtYXQ6CiAqICJsYW5ndWFnZV90YWd8dmFsdWVfZm9yX2xhbmd1YWdlLC4uLiIuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCB0YWtlIHRoZSBsaXN0IG9mIHJlcXVlc3RlZCBsYW5ndWFnZXMgZnJvbSB0aGUgJ2NsYWltc19sb2NhbGVzJyBhdXRob3JpemUgcmVxdWVzdAogKiBwYXJhbWV0ZXIgYW5kIGF0dGVtcHQgdG8gbWF0Y2ggaXQgdG8gYSB2YWx1ZSBmcm9tIHRoZSB1c2VycycgcHJvZmlsZSBhdHRyaWJ1dGUuCiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uCiAqLwpjbGFpbUxvY2FsZXNDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgaWYgKGlkZW50aXR5ICE9IG51bGwpIHsKICAgICAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwpIHsKICAgICAgICAgICAgbG9jYWxlVmFsdWVzID0gcGFyc2VMb2NhbGVBd2FyZVN0cmluZyh1c2VyUHJvZmlsZVZhbHVlKQogICAgICAgICAgICBsb2NhbGUgPSBjbGFpbXNMb2NhbGVzLmZpbmQgeyBsb2NhbGUgLT4gbG9jYWxlVmFsdWVzLmNvbnRhaW5zS2V5KGxvY2FsZSkgfQogICAgICAgICAgICBpZiAobG9jYWxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IGxvY2FsZVZhbHVlcy5nZXQobG9jYWxlKV0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBbOl0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggZXhwZWN0cyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIHZhbHVlIHRvIGJlIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogKiAibGFuZ3VhZ2VfdGFnfHZhbHVlX2Zvcl9sYW5ndWFnZSwuLi4iLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgdGFrZSB0aGUgbGFuZ3VhZ2UgdGFnIHNwZWNpZmllZCBpbiB0aGUgY2xhaW0gb2JqZWN0IGFuZCBhdHRlbXB0IHRvIG1hdGNoIGl0IHRvIGEgdmFsdWUKICogZnJvbSB0aGUgdXNlcnMnIHByb2ZpbGUgYXR0cmlidXRlLiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KbGFuZ3VhZ2VUYWdDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgaWYgKGlkZW50aXR5ICE9IG51bGwpIHsKICAgICAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwpIHsKICAgICAgICAgICAgbG9jYWxlVmFsdWVzID0gcGFyc2VMb2NhbGVBd2FyZVN0cmluZyh1c2VyUHJvZmlsZVZhbHVlKQogICAgICAgICAgICBpZiAoY2xhaW0uZ2V0TG9jYWxlKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGxvY2FsZVZhbHVlcy5jb250YWluc0tleShjbGFpbS5nZXRMb2NhbGUoKSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyhjbGFpbS5nZXROYW1lKCkpOiBsb2NhbGVWYWx1ZXMuZ2V0KGNsYWltLmdldExvY2FsZSgpKV0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSBsb2NhbGVWYWx1ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpLm5leHQoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSArICIjIiArIGVudHJ5LmdldEtleSgpKTogZW50cnkuZ2V0VmFsdWUoKV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gbG9jYWxlVmFsdWVzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCkKICAgICAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IGVudHJ5LmdldFZhbHVlKCldCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gWzpdCn0KCi8qCiAqIEdpdmVuIGEgc3RyaW5nICJlbnxFbmdsaXNoLGpwfEphcGVuZXNlLGZyX0NBfEZyZW5jaCBDYW5hZGlhbiIgd2lsbCByZXR1cm4gbWFwIG9mIGxvY2FsZSAtPiB2YWx1ZS4KICovCnBhcnNlTG9jYWxlQXdhcmVTdHJpbmcgPSB7IHMgLT4KICAgIHJldHVybiByZXN1bHQgPSBzLnNwbGl0KCIsIikuY29sbGVjdEVudHJpZXMgeyBlbnRyeSAtPgogICAgICAgIHNwbGl0ID0gZW50cnkuc3BsaXQoIlxcfCIpCiAgICAgICAgWyhzcGxpdFswXSk6IHZhbHVlID0gc3BsaXRbMV1dCiAgICB9Cn0KLy8gLS0tXl5eXl5eXl5eXi0tLSBFWEFNUExFIENMQUlNIEFUVFJJQlVURSBSRVNPTFZFUiBGVU5DVElPTlMgLS0tXl5eXl5eXl5eXi0tLQoKLy8gLS0tLS0tLS0tLS0tLS0gVVBEQVRFIFRISVMgVE8gQ0hBTkdFIENMQUlNIFRPIEFUVFJJQlVURSBNQVBQSU5HIEZVTkNUSU9OUyAtLS0tLS0tLS0tLS0tLS0KLyoKICogTGlzdCBvZiBjbGFpbSByZXNvbHZlciBtYXBwaW5ncy4KICovCi8vIFsge2NsYWltfToge2F0dHJpYnV0ZSByZXRyaWV2ZXJ9LCAuLi4gXQpjbGFpbUF0dHJpYnV0ZXMgPSBbCiAgICAgICAgImVtYWlsIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJtYWlsIiksCiAgICAgICAgImFkZHJlc3MiOiB7IGNsYWltLCBpZGVudGl0eSAtPiBbICJhZGRyZXNzIiA6IHVzZXJBZGRyZXNzQ2xhaW1SZXNvbHZlcihjbGFpbSwgaWRlbnRpdHkpIF0gfSwKICAgICAgICAicGhvbmVfbnVtYmVyIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJ0ZWxlcGhvbmVudW1iZXIiKSwKICAgICAgICAiZ2l2ZW5fbmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgiZ2l2ZW5uYW1lIiksCiAgICAgICAgInpvbmVpbmZvIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJwcmVmZXJyZWR0aW1lem9uZSIpLAogICAgICAgICJmYW1pbHlfbmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgic24iKSwKICAgICAgICAibG9jYWxlIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJwcmVmZXJyZWRsb2NhbGUiKSwKICAgICAgICAibmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgiY24iKSwKICAJCSJyb2xlcyI6IHsgY2xhaW0sIGlkZW50aXR5IC0+IFsgInJvbGVzIiA6IGlkZW50aXR5LmdldE1lbWJlcnNoaXBzKElkVHlwZS5HUk9VUCkuY29sbGVjdCB7IGdyb3VwIC0+ICdST0xFXycgKyBncm91cC5uYW1lIH1dfSAKXQoKCi8vIC0tLS0tLS0tLS0tLS0tIFVQREFURSBUSElTIFRPIENIQU5HRSBTQ09QRSBUTyBDTEFJTSBNQVBQSU5HUyAtLS0tLS0tLS0tLS0tLQovKgogKiBNYXAgb2Ygc2NvcGVzIHRvIGNsYWltIG9iamVjdHMuCiAqLwovLyB7c2NvcGV9OiBbIHtjbGFpbX0sIC4uLiBdCnNjb3BlQ2xhaW1zTWFwID0gWwogICAgICAgICJlbWFpbCI6IFsgImVtYWlsIiBdLAogICAgICAgICJhZGRyZXNzIjogWyAiYWRkcmVzcyIgXSwKICAgICAgICAicGhvbmUiOiBbICJwaG9uZV9udW1iZXIiIF0sCiAgCQkiYXBwb2ludG1lbnRzIjogWyAicm9sZXMiIF0sCiAgICAgICAgInByb2ZpbGUiOiBbICJnaXZlbl9uYW1lIiwgInpvbmVpbmZvIiwgImZhbWlseV9uYW1lIiwgImxvY2FsZSIsICJuYW1lIiwgInJvbGVzIiBdCl0KCgovLyAtLS0tLS0tLS0tLS0tLS0tIFVQREFURSBCRUxPVyBGT1IgQURWQU5DRUQgVVNBR0VTIC0tLS0tLS0tLS0tLS0tLS0tLS0KaWYgKGxvZ2dlci5tZXNzYWdlRW5hYmxlZCgpKSB7CiAgICBzY29wZXMuZmluZEFsbCB7IHMgLT4gISgib3BlbmlkIi5lcXVhbHMocykgfHwgc2NvcGVDbGFpbXNNYXAuY29udGFpbnNLZXkocykpIH0uZWFjaCB7IHMgLT4KICAgICAgICBsb2dnZXIubWVzc2FnZSgiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTo6TWVzc2FnZTogc2NvcGUgbm90IGJvdW5kIHRvIGNsYWltczogJHMiKQogICAgfQp9CgovKgogKiBDb21wdXRlcyB0aGUgY2xhaW1zIHJldHVybiBrZXkgYW5kIHZhbHVlLiBUaGUga2V5IG1heSBiZSBhIGRpZmZlcmVudCB2YWx1ZSBpZiB0aGUgY2xhaW0gdmFsdWUgaXMgbm90IGluCiAqIHRoZSByZXF1ZXN0ZWQgbGFuZ3VhZ2UuCiAqLwpkZWYgY29tcHV0ZUNsYWltID0geyBjbGFpbSAtPgogICAgdHJ5IHsKICAgICAgICBjbGFpbVJlc29sdmVyID0gY2xhaW1BdHRyaWJ1dGVzLmdldChjbGFpbS5nZXROYW1lKCksIHsgY2xhaW1PYmosIGlkZW50aXR5IC0+IGRlZmF1bHRDbGFpbVJlc29sdmVyKGNsYWltKX0pCiAgICAgICAgY2xhaW1SZXNvbHZlcihjbGFpbSwgaWRlbnRpdHkpCiAgICB9IGNhdGNoIChJZFJlcG9FeGNlcHRpb24gZSkgewogICAgICAgIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogVW5hYmxlIHRvIHJldHJpZXZlIGF0dHJpYnV0ZT0kYXR0cmlidXRlIiwgZSk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoU1NPRXhjZXB0aW9uIGUpIHsKICAgICAgICBpZiAobG9nZ2VyLndhcm5pbmdFbmFibGVkKCkpIHsKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IFVuYWJsZSB0byByZXRyaWV2ZSBhdHRyaWJ1dGU9JGF0dHJpYnV0ZSIsIGUpOwogICAgICAgIH0KICAgIH0KfQoKLyoKICogQ29udmVydHMgcmVxdWVzdGVkIHNjb3BlcyBpbnRvIGNsYWltIG9iamVjdHMgYmFzZWQgb24gdGhlIHNjb3BlIG1hcHBpbmdzIGluIHNjb3BlQ2xhaW1zTWFwLgogKi8KZGVmIGNvbnZlcnRTY29wZVRvQ2xhaW1zID0gewogICAgc2NvcGVzLmZpbmRBbGwgeyBzY29wZSAtPiAib3BlbmlkIiAhPSBzY29wZSAmJiBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzY29wZSkgfS5jb2xsZWN0TWFueSB7IHNjb3BlIC0+CiAgICAgICAgc2NvcGVDbGFpbXNNYXAuZ2V0KHNjb3BlKS5jb2xsZWN0IHsgY2xhaW0gLT4KICAgICAgICAgICAgbmV3IENsYWltKGNsYWltKQogICAgICAgIH0KICAgIH0KfQoKLy8gQ3JlYXRlcyBhIGZ1bGwgbGlzdCBvZiBjbGFpbXMgdG8gcmVzb2x2ZSBmcm9tIHJlcXVlc3RlZCBzY29wZXMsIGNsYWltcyBwcm92aWRlZCBieSBBUyBhbmQgcmVxdWVzdGVkIGNsYWltcwpkZWYgY2xhaW1zVG9SZXNvbHZlID0gY29udmVydFNjb3BlVG9DbGFpbXMoKSArIGNsYWltT2JqZWN0cyArIHJlcXVlc3RlZFR5cGVkQ2xhaW1zCgovLyBDb21wdXRlcyB0aGUgY2xhaW0gcmV0dXJuIGtleSBhbmQgdmFsdWVzIGZvciBhbGwgcmVxdWVzdGVkIGNsYWltcwpjb21wdXRlZENsYWltcyA9IGNsYWltc1RvUmVzb2x2ZS5jb2xsZWN0RW50cmllcygpIHsgY2xhaW0gLT4KICAgIHJlc3VsdCA9IGNvbXB1dGVDbGFpbShjbGFpbSkKfQoKLy8gQ29tcHV0ZXMgY29tcG9zaXRlIHNjb3BlcwpkZWYgY29tcG9zaXRlU2NvcGVzID0gc2NvcGVDbGFpbXNNYXAuZmluZEFsbCB7IHNjb3BlIC0+CiAgICBzY29wZXMuY29udGFpbnMoc2NvcGUua2V5KQp9CgpyZXR1cm4gbmV3IFVzZXJJbmZvQ2xhaW1zKChNYXApY29tcHV0ZWRDbGFpbXMsIChNYXApY29tcG9zaXRlU2NvcGVzKQ==",
    "lastModifiedBy" : "null",
    "lastModifiedDate" : "0",
    "language" : "GROOVY",
    "name" : "OIDC Claims Script",
    "context" : "OIDC_CLAIMS",
    "createdBy" : "null",
    "creationDate" : "0",
    "description" : "Default global script for OIDC claims",
    "_type" : {
      "_id" : "globalScript",
      "name" : "Scripting",
      "collection" : true
    }
  }
}