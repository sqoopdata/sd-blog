{
  "metadata" : {
    "realm" : "/emr",
    "amsterVersion" : "7.1.0",
    "entityType" : "Scripts",
    "entityId" : "d22f9a0c-426a-4466-b95e-d0f125b0d5fa",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "d22f9a0c-426a-4466-b95e-d0f125b0d5fa",
    "name" : "OAuth2 Access Token Modification Script",
    "description" : "Default global script for OAuth2 Access Token Modification",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTktMjAyMCBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCgppbXBvcnQgb3JnLmZvcmdlcm9jay5odHRwLnByb3RvY29sLlJlcXVlc3QKaW1wb3J0IG9yZy5mb3JnZXJvY2suaHR0cC5wcm90b2NvbC5SZXNwb25zZQoKaW1wb3J0IGNvbS5pcGxhbmV0LnNzby5TU09FeGNlcHRpb24KCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgoKLyoqCiAqIERlZmluZWQgdmFyaWFibGVzOgogKiBhY2Nlc3NUb2tlbiAtIFRoZSBhY2Nlc3MgdG9rZW4gdG8gYmUgdXBkYXRlZC4gTXV0YWJsZSBvYmplY3QsIGFsbCBjaGFuZ2VzIHRvIHRoZSBhY2Nlc3MgdG9rZW4gd2lsbCBiZSByZWZsZWN0ZWQuCiAqIGh0dHBDbGllbnQgLSBhbHdheXMgcHJlc2VudCwgdGhlIEhUVFAgY2xpZW50IHRoYXQgY2FuIGJlIHVzZWQgdG8gbWFrZSBleHRlcm5hbCBIVFRQIHJlcXVlc3RzCiAqIGlkZW50aXR5IC0gYWx3YXlzIHByZXNlbnQsIHRoZSBpZGVudGl0eSBvZiB0aGUgcmVzb3VyY2Ugb3duZXIKICogbG9nZ2VyIC0gYWx3YXlzIHByZXNlbnQsIGNvcnJlc3BvbmRpbmcgbG9nIGZpbGVzIHdpbGwgYmUgcHJlZml4ZWQgd2l0aDogc2NyaXB0cy5PQVVUSDJfQUNDRVNTX1RPS0VOX01PRElGSUNBVElPTi4KICogc2NvcGVzIC0gYWx3YXlzIHByZXNlbnQsIHRoZSByZXF1ZXN0ZWQgc2NvcGVzCiAqIHNlc3Npb24gLSBwcmVzZW50IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIHRoZSBzZXNzaW9uIGNvb2tpZSwgdGhlIHVzZXIncyBzZXNzaW9uIG9iamVjdAogKiBzY3JpcHROYW1lIC0gYWx3YXlzIHByZXNlbnQsIHRoZSBkaXNwbGF5IG5hbWUgb2YgdGhlIHNjcmlwdAogKiByZXF1ZXN0UHJvcGVydGllcyAtIGFsd2F5cyBwcmVzZW50LCBjb250YWlucyBhIG1hcCBvZiByZXF1ZXN0IHByb3BlcnRpZXM6CiAqICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFVyaSAtIHRoZSByZXF1ZXN0IFVSSQogKiAgICAgICAgICAgICAgICAgICAgIHJlYWxtIC0gdGhlIHJlYWxtIHRoYXQgdGhlIHJlcXVlc3QgcmVsYXRlcyB0bwogKiAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RQYXJhbXMgLSBhIG1hcCBvZiB0aGUgcmVxdWVzdCBwYXJhbXMgYW5kL29yIHBvc3RlZCBkYXRhLiBFYWNoIHZhbHVlIGlzIGEgbGlzdCBvZiBvbmUgb3IKICogICAgICAgICAgICAgICAgICAgICBtb3JlIHByb3BlcnRpZXMuIFBsZWFzZSBub3RlIHRoYXQgdGhlc2Ugc2hvdWxkIGJlIGhhbmRsZWQgaW4gYWNjb3JkYW5jZSB3aXRoIE9XQVNQIGJlc3QKICogICAgICAgICAgICAgICAgICAgICBwcmFjdGljZXMuCiAqIGNsaWVudFByb3BlcnRpZXMgLSBwcmVzZW50IGlmIHRoZSBjbGllbnQgc3BlY2lmaWVkIGluIHRoZSByZXF1ZXN0IHdhcyBpZGVudGlmaWVkLCBjb250YWlucyBhIG1hcCBvZiBjbGllbnQKICogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6CiAqICAgICAgICAgICAgICAgICAgICBjbGllbnRJZCAtIHRoZSBjbGllbnQncyBVcmkgZm9yIHRoZSByZXF1ZXN0IGxvY2FsZQogKiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZEdyYW50VHlwZXMgLSBsaXN0IG9mIHRoZSBhbGxvd2VkIGdyYW50IHR5cGVzIChvcmcuZm9yZ2Vyb2NrLm9hdXRoMi5jb3JlLkdyYW50VHlwZSkKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRoZSBjbGllbnQKICogICAgICAgICAgICAgICAgICAgIGFsbG93ZWRSZXNwb25zZVR5cGVzIC0gbGlzdCBvZiB0aGUgYWxsb3dlZCByZXNwb25zZSB0eXBlcyBmb3IgdGhlIGNsaWVudAogKiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFNjb3BlcyAtIGxpc3Qgb2YgdGhlIGFsbG93ZWQgc2NvcGVzIGZvciB0aGUgY2xpZW50CiAqICAgICAgICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzIC0gQSBtYXAgb2YgdGhlIGN1c3RvbSBwcm9wZXJ0aWVzIG9mIHRoZSBjbGllbnQuCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdHMgb3IgbWFwcyB3aWxsIGJlIGluY2x1ZGVkIGFzIHN1Yi1tYXBzLCBlLmc6CiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdE1hcFtLZXkxXT1WYWx1ZTEgd2lsbCBiZSByZXR1cm5lZCBhcyB0ZXN0bWFwIC0+IEtleTEgLT4gVmFsdWUxCiAqCiAqIE5vIHJldHVybiB2YWx1ZSAtIGNoYW5nZXMgc2hhbGwgYmUgbWFkZSB0byB0aGUgYWNjZXNzVG9rZW4gcGFyYW1ldGVyIGRpcmVjdGx5LgogKgogKiBUaGUgY2hhbmdlcyBtYWRlIHRvIE9BdXRoMiBhY2Nlc3MgdG9rZW5zIHdpbGwgZGlyZWN0bHkgaW1wYWN0IHRoZSBzaXplIG9mIHRoZSBDVFMgdG9rZW5zLCBhbmQgc2ltaWxhcmx5IHRoZSBzaXplIG9mCiAqIHRoZSBKV1RzIGlmIGNsaWVudCBiYXNlZCBPQXV0aDIgdG9rZW5zIGFyZSB1dGlsaXNlZC4KICogV2hlbiBhZGRpbmcvdXBkYXRpbmcgZmllbGRzIG1ha2Ugc3VyZSB0aGF0IHRoZSB0b2tlbiBzaXplIHJlbWFpbnMgd2l0aGluIGNsaWVudC91c2VyLWFnZW50IGxpbWl0cy4KICovCgovKgovL0ZpZWxkIHRvIGFsd2F5cyBpbmNsdWRlIGluIHRva2VuCmFjY2Vzc1Rva2VuLnNldEZpZWxkKCJoZWxsbyIsICJ3b3JsZCIpCgovL09idGFpbiBhZGRpdGlvbmFsIHZhbHVlcyBieSBwZXJmb3JtaW5nIGEgUkVTVCBjYWxsIHRvIGFuIGV4dGVybmFsIHNlcnZpY2UKdHJ5IHsKICAgIFJlc3BvbnNlIHJlc3BvbnNlID0gaHR0cENsaWVudC5zZW5kKG5ldyBSZXF1ZXN0KCkKICAgICAgICAgICAgLnNldFVyaSgiaHR0cHM6Ly90aGlyZC5wYXJ0eS5hcHAvaGVsbG8uanNwIikKICAgICAgICAgICAgLnNldE1ldGhvZCgiUE9TVCIpCiAgICAgICAgICAgIC5tb2RpZnlIZWFkZXJzKHsgaGVhZGVycyAtPiBoZWFkZXJzLnB1dCgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCIpIH0pCi8vICAgICAgICAgIC5zZXRFbnRpdHkoJ2Zvbz1iYXImaGVsbG89d29ybGQnKSkKICAgICAgICAgICAgLnNldEVudGl0eShbZm9vOiAnYmFyJ10pKQogICAgICAgICAgICAuZ2V0T3JUaHJvdygpCiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzLnN1Y2Nlc3NmdWwpIHsKICAgICAgICBkZWYgcmVzdWx0ID0gbmV3IEpzb25TbHVycGVyKCkucGFyc2VUZXh0KHJlc3BvbnNlLmVudGl0eS5zdHJpbmcpCiAgICAgICAgYWNjZXNzVG9rZW4uc2V0RmllbGRzKHJlc3VsdC5nZXQoInVwZGF0ZWRGaWVsZHMiKSkKICAgIH0gZWxzZSB7CiAgICAgICAgbG9nZ2VyLmVycm9yKCJVbmFibGUgdG8gb2J0YWluIGFjY2VzcyB0b2tlbiBtb2RpZmljYXRpb25zOiB7fSwge30iLCByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLmVudGl0eS50b1N0cmluZygpKQogICAgfQp9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBleCkgewogICAgbG9nZ2VyLmVycm9yKCJUaGUgcmVxdWVzdCBwcm9jZXNzaW5nIHdhcyBpbnRlcnJ1cHRlZCIsIGV4KQogICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKQogICAgLy9UaGUgYWNjZXNzIHRva2VuIHJlcXVlc3Qgd2lsbCBmYWlsIHdpdGggSFRUUCA1MDAgZXJyb3IgaW4gdGhpcyBjYXNlLgogICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oIlVuYWJsZSB0byBvYnRhaW4gcmVzcG9uc2UgZnJvbSAiKQp9CgovL0FkZCBuZXcgZmllbGRzIGNvbnRhaW5pbmcgaWRlbnRpdHkgYXR0cmlidXRlIHZhbHVlcwpkZWYgYXR0cmlidXRlcyA9IGlkZW50aXR5LmdldEF0dHJpYnV0ZXMoWyJtYWlsIiwgInRlbGVwaG9uZU51bWJlciJdLnRvU2V0KCkpCmFjY2Vzc1Rva2VuLnNldEZpZWxkKCJtYWlsIiwgYXR0cmlidXRlc1sibWFpbCJdKQphY2Nlc3NUb2tlbi5zZXRGaWVsZCgicGhvbmUiLCBhdHRyaWJ1dGVzWyJ0ZWxlcGhvbmVOdW1iZXIiXSkKCi8vQWRkIG5ldyBmaWVsZHMgY29udGFpbmluZyBzZXNzaW9uIHByb3BlcnR5IHZhbHVlcwppZiAoc2Vzc2lvbiAhPSBudWxsKSB7IC8vIHNlc3Npb24gaXMgbm90IGF2YWlsYWJsZSBmb3IgcmVzb3VyY2Ugb3duZXIgcGFzc3dvcmQgY3JlZGVudGlhbHMgZ3JhbnQKICAgIHRyeSB7CiAgICAgICAgYWNjZXNzVG9rZW4uc2V0RmllbGQoImlwQWRkcmVzcyIsIHNlc3Npb24uZ2V0UHJvcGVydHkoIkhvc3QiKSkKICAgIH0gY2F0Y2ggKFNTT0V4Y2VwdGlvbiBleCkgewogICAgICAgIGxvZ2dlci5lcnJvcigiVW5hYmxlIHRvIHJldHJpZXZlIHNlc3Npb24gcHJvcGVydHkgdmFsdWUiLCBleCkKICAgIH0KfQoKLy8gUmVtb3ZlIGEgbmF0aXZlIGZpZWxkIGZyb20gdGhlIHRva2VuIGVudHJ5LCB0aGF0IHdhcyBzZXQgYnkgQU0uIEZvciBjb21wbGV0ZSBsaXN0IG9mIHJlbW92ZSogbWV0aG9kcyBzZWUgdGhlIEphdmFEb2MKLy8gZm9yIG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuQWNjZXNzVG9rZW4gY2xhc3MuCmFjY2Vzc1Rva2VuLnJlbW92ZVRva2VuTmFtZSgpCiov",
    "default" : true,
    "language" : "GROOVY",
    "context" : "OAUTH2_ACCESS_TOKEN_MODIFICATION",
    "createdBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate" : 1433147666269,
    "lastModifiedBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate" : 1433147666269
  }
}